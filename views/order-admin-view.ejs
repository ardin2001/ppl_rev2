<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <title>Document</title>
</head>
<body>
    <div class="container">
        <h2>Page Order</h2>
        <!-- <a href="/create-produk" class="btn btn-success">Tambah Produk</a> -->
        <table class="table">
            <thead>
              <tr>
                <th scope="col">id</th>
                <th scope="col">id_user</th>
                <th scope="col">id_barang</th>
                <th scope="col">Barang</th>
                <th scope="col">Harga</th>
                <th scope="col">Jumlah</th>
                <th scope="col">Total</th>
                <th scope="col">Bukti TF</th>
                <th scope="col">tanggal</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
                <% Order.forEach(e => { %>
                    <tr>
                        <td><%= e.id_order %> </td>
                        <td><%= e.id_user %> </td>
                        <td><%= e.id_barang %> </td>
                        <td><%= e.nama_barang %> </td>
                        <td><%= e.harga %> </td>
                        <td><%= e.jumlah %> </td>
                        <td><%= e.total %> </td>
                        <td><img src="img/<%= e.info %>" width="60px" height="60px"></td>
                        <td ><%= e.updatedAt.toLocaleDateString() %> </td>
                        <td>
                            <button onclick= <%= "del("+e.id_order+")" %>  type="button" class="btn btn-danger">Tolak</button>
                            
                            <button onclick= <%= "create("+[e.id_order,e.id_user,e.id_barang,e.jumlah,e.harga,"'"+e.info+"'"]+")" %>  type="button" class="btn btn-success" >Terima</button>                            
                        </td>
                    </tr>
                <% }) %>
            </tbody>
          </table>
    </div>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script>
        const del = (id) =>{
            alert('Are you delete id : ' +id)
            axios.delete('/api/transaksi/'+id).then(result =>{
                alert('info status : '+ result.status)
                location.reload()
            }).catch(err =>{
                alert('error : '+err)
            });
        }
        const create = (idorder,iduser,idbarang,jumlah,hargabarang,buktitf) =>{
            axios({
                method : 'post',
                url : '/api/transaksi',
                data :{
                    id_barang : idbarang,
                    id_user : iduser,
                    jumlah : jumlah,
                    harga : hargabarang,                
                    info : buktitf
                    }
                    }).then(result =>{
                        alert('info status: '+result.status)
                        window.location = "http://127.0.0.1:3000/user";
                    }).catch(err =>{
                        alert('error :'+err)
                        window.location = "/"
                    });
            axios.delete('/api/order/'+idorder).then(result =>{
                alert('info status : '+ result.status)
                location.reload()
                }).catch(err =>{
                    alert('error : '+err)
                });
            }
    </script>
</body>
</html>